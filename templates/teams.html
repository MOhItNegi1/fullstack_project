{% extends "base.html" %}
{% block title %}Projects - Jira{% endblock %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<div class="container py-5">
  <h2 class="mb-4">Project Management</h2>

  <!-- Project Form -->
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">
      Create New Project
    </div>
    <div class="card-body">
      <form id="projectForm">
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="name" class="form-label">Project Name</label>
            <input type="text" class="form-control" id="name" required>
          </div>
          <div class="col-md-6">
            <label for="deadline" class="form-label">Deadline</label>
            <input type="date" class="form-control" id="deadline" required>
          </div>
        </div>
        <div class="mb-3">
          <label for="description" class="form-label">Description</label>
          <textarea class="form-control" id="description" rows="3"></textarea>
        </div>
        <button type="submit" class="btn btn-success">Create Project</button>
      </form>
    </div>
  </div>

  <!-- Project List -->
  <div class="card">
    <div class="card-header bg-secondary text-white">
      Existing Projects
    </div>
    <div class="card-body p-0">
      <table class="table table-hover m-0">
        <thead class="table-light">
          <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Deadline</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="projectTableBody">
          <tr>
            <td colspan="5" class="text-center">Loading...</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  const token = localStorage.getItem("access_token");

  // Create Project
  document.getElementById("projectForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    const name = document.getElementById("name").value;
    const description = document.getElementById("description").value;
    const deadline = document.getElementById("deadline").value;

    const res = await fetch("/projects", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      },
      body: JSON.stringify({ name, description, deadline })
    });

    const data = await res.json();
    if (res.ok) {
      alert("Project created!");
      loadProjects();
      document.getElementById("projectForm").reset();
    } else {
      alert(data.message || "Error creating project.");
    }
  });

  // Load Projects
  async function loadProjects() {
    const res = await fetch("/projects/all", {
      headers: {
        "Authorization": "Bearer " + token
      }
    });

    const data = await res.json();
    const tbody = document.getElementById("projectTableBody");
    tbody.innerHTML = "";

    if (data.length === 0) {
      tbody.innerHTML = `<tr><td colspan="5" class="text-center">No projects found.</td></tr>`;
      return;
    }

    data.forEach(p => {
      const row = `
        <tr>
          <td>${p.name}</td>
          <td>${p.description}</td>
          <td>${p.deadline}</td>
          <td>${p.status}</td>
          <td>
            <button class="btn btn-sm btn-outline-primary me-2" disabled>Edit</button>
            <button class="btn btn-sm btn-outline-danger" disabled>Delete</button>
          </td>
        </tr>
      `;
      tbody.insertAdjacentHTML("beforeend", row);
    });
  }

  window.onload = loadProjects;
</script>
{% endblock %}
